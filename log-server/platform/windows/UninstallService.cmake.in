#
# Copyright 2013-2016 Will Mason
# 
#    Licensed under the Apache License, Version 2.0 (the "License");
#    you may not use this file except in compliance with the License.
#    You may obtain a copy of the License at
# 
#      http://www.apache.org/licenses/LICENSE-2.0
# 
#    Unless required by applicable law or agreed to in writing, software
#    distributed under the License is distributed on an "AS IS" BASIS,
#    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#    See the License for the specific language governing permissions and
#    limitations under the License.
#

MESSAGE(STATUS "Uninstalling the Chucho service")
MESSAGE(STATUS "Stopping existing service")
EXECUTE_PROCESS(COMMAND "${CHUCHO_SC}" stop Chucho
                RESULT_VARIABLE SC_RESULT)
IF(NOT SC_RESULT EQUAL 0 AND NOT SC_RESULT EQUAL 1060 AND NOT SC_RESULT EQUAL 1062)
    MESSAGE(FATAL_ERROR "Could stop the service")
ENDIF()
MESSAGE(STATUS "Deleting existing service")
EXECUTE_PROCESS(COMMAND "${CHUCHO_SC}" delete Chucho
                RESULT_VARIABLE SC_RESULT)
IF(NOT SC_RESULT EQUAL 0 AND NOT SC_RESULT EQUAL 1060)
    MESSAGE(FATAL_ERROR "Could not delete the service")
ENDIF()
IF(SC_RESULT EQUAL 0)
    MESSAGE(STATUS "Waiting one second, so that the existing Chucho server can shut down")
    EXECUTE_PROCESS(COMMAND cmd.exe /c "ping -n 2 127.0.0.1 >nul")
ENDIF()
